<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DPlayer Video Player</title>
    <!-- 引入 DPlayer 样式文件 -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/dplayer/dist/DPlayer.min.css"
    />
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }

      #dplayer-container {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>

  <body>
    <!-- 创建一个容器用于放置视频播放器 -->
    <div id="dplayer-container"></div>
    <!-- 引入 Hls.js 库 -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <!-- 引入 DPlayer JavaScript 文件 -->
    <script src="https://cdn.jsdelivr.net/npm/dplayer/dist/DPlayer.min.js"></script>

    <script>
        const params = new URLSearchParams(location.search);
        const file = params.get('file');
    
        if (!file) {
            alert('无效的视频地址');
        }
    
        // 请求签名 URL
        fetch(`/api/video-url?file=${file}`)
            .then(res => res.json())
            .then(data => {
                const dp = new DPlayer({
                    container: document.getElementById('dplayer-container'),
                    video: {
                        url: data.url
                    },
                    autoplay: false
                });
            })
            .catch(err => {
                console.error(err);
                alert('视频加载失败');
            });
    </script>
    
  </body>
</html>
